{
  "gameId": "string",
  "version": 0.2,

  "sheetSpec": {
    "version": "1.0",
    "notes": "Spreadsheet contract used to ensure tabs + headers exist. Does not validate row values.",
    "settings": {
      "headerRowIndex": 1,
      "freezeHeaderRow": true,
      "allowExtraColumns": true,
      "newColumnsPolicy": "append",
      "reservedSheets": ["PackMeta", "Dropdowns", "__Index", "__Notes"]
    },

    "tables": [
      {
        "name": "PackMeta",
        "required": true,
        "kind": "meta",
        "primaryKey": "key",
        "columns": [
          { "name": "key", "required": true, "type": "string" },
          { "name": "value", "required": true, "type": "string" }
        ],
        "recommendedRows": [
          { "key": "schemaVersion", "value": "0.2" },
          { "key": "schemaUrl", "value": "" }
        ]
      },

      {
        "name": "Resources",
        "required": true,
        "kind": "entity",
        "primaryKey": "id",
        "columns": [
          { "name": "id", "required": true, "type": "resourceId" },
          { "name": "displayName", "required": true, "type": "string" },
          {
            "name": "kind",
            "required": true,
            "type": "enum",
            "enumRef": "enums.resourceKind"
          },
          {
            "name": "format.style",
            "required": false,
            "type": "enum",
            "enumRef": "enums.resourceFormatStyle"
          },
          { "name": "format.symbol", "required": false, "type": "string" },
          { "name": "stackLimit", "required": false, "type": "numberString" }
        ]
      },

      {
        "name": "Zones",
        "required": true,
        "kind": "entity",
        "primaryKey": "id",
        "columns": [
          { "name": "id", "required": true, "type": "zoneId" },
          { "name": "displayName", "required": true, "type": "string" },
          { "name": "startingPhaseId", "required": false, "type": "phaseId" },
          { "name": "localResources_json", "required": false, "type": "json" },
          { "name": "tags", "required": false, "type": "stringList" }
        ]
      },

      {
        "name": "Nodes",
        "required": true,
        "kind": "entity",
        "primaryKey": "id",
        "columns": [
          { "name": "id", "required": true, "type": "nodeTypeId" },
          {
            "name": "type",
            "required": true,
            "type": "enum",
            "enumRef": "enums.nodeType"
          },
          { "name": "displayName", "required": true, "type": "string" },
          { "name": "zoneId", "required": true, "type": "zoneId" },
          { "name": "tags", "required": false, "type": "stringList" },

          {
            "name": "cycle.baseDurationSeconds",
            "required": false,
            "type": "numberString"
          },
          {
            "name": "automation.policy",
            "required": false,
            "type": "enum",
            "enumRef": "enums.automationPolicy"
          },

          {
            "name": "leveling.levelResource",
            "required": false,
            "type": "resourceId"
          },
          { "name": "leveling.baseLevel", "required": false, "type": "int" },
          {
            "name": "leveling.priceCurve.type",
            "required": false,
            "type": "enum",
            "enumRef": "enums.priceCurveType"
          },
          {
            "name": "leveling.priceCurve.basePrice",
            "required": false,
            "type": "bigNumberString"
          },
          {
            "name": "leveling.priceCurve.growth",
            "required": false,
            "type": "numberString"
          }
        ]
      },

      {
        "name": "NodeOutputs",
        "required": false,
        "kind": "subtable",
        "parent": { "table": "Nodes", "column": "nodeId", "ref": "Nodes.id" },
        "columns": [
          { "name": "nodeId", "required": true, "type": "nodeTypeId" },
          { "name": "resource", "required": true, "type": "resourceId" },
          {
            "name": "mode",
            "required": true,
            "type": "enum",
            "enumRef": "enums.outputMode"
          },
          {
            "name": "basePerSecond",
            "required": false,
            "type": "bigNumberString"
          },
          {
            "name": "basePayout",
            "required": false,
            "type": "bigNumberString"
          },
          {
            "name": "amountPerCycle",
            "required": false,
            "type": "bigNumberString"
          }
        ]
      },

      {
        "name": "NodeInputs",
        "required": false,
        "kind": "subtable",
        "parent": { "table": "Nodes", "column": "nodeId", "ref": "Nodes.id" },
        "columns": [
          { "name": "nodeId", "required": true, "type": "nodeTypeId" },
          { "name": "resource", "required": true, "type": "resourceId" },
          {
            "name": "amountPerCycle",
            "required": false,
            "type": "bigNumberString"
          }
        ]
      },

      {
        "name": "NodeCapacities",
        "required": false,
        "kind": "subtable",
        "parent": { "table": "Nodes", "column": "nodeId", "ref": "Nodes.id" },
        "columns": [
          { "name": "nodeId", "required": true, "type": "nodeTypeId" },
          { "name": "resource", "required": true, "type": "resourceId" },
          {
            "name": "capacityMode",
            "required": true,
            "type": "enum",
            "enumRef": "enums.capacityMode"
          },
          {
            "name": "baseCapacity",
            "required": false,
            "type": "bigNumberString"
          },
          {
            "name": "baseCapacityPerSecond",
            "required": false,
            "type": "bigNumberString"
          }
        ]
      },

      {
        "name": "Modifiers",
        "required": true,
        "kind": "entity",
        "primaryKey": "id",
        "columns": [
          { "name": "id", "required": true, "type": "modifierId" },
          { "name": "source", "required": true, "type": "string" },
          { "name": "zoneId", "required": false, "type": "zoneId" },

          {
            "name": "scope.kind",
            "required": true,
            "type": "enum",
            "enumRef": "enums.scopeKind"
          },
          { "name": "scope.zoneId", "required": false, "type": "zoneId" },
          { "name": "scope.nodeId", "required": false, "type": "nodeTypeId" },
          { "name": "scope.nodeTag", "required": false, "type": "string" },
          { "name": "scope.resource", "required": false, "type": "resourceId" },

          {
            "name": "operation",
            "required": true,
            "type": "enum",
            "enumRef": "enums.modifierOperation"
          },
          { "name": "target", "required": true, "type": "string" },
          {
            "name": "value",
            "required": false,
            "type": "numberOrBigNumberString"
          }
        ],
        "notes": [
          "target uses bracket syntax for resource-param targets: nodeOutput[currencySoft], resourceGain[currencySoft], etc."
        ]
      },

      {
        "name": "Upgrades",
        "required": true,
        "kind": "entity",
        "primaryKey": "id",
        "columns": [
          { "name": "id", "required": true, "type": "upgradeId" },
          { "name": "displayName", "required": true, "type": "string" },
          {
            "name": "category",
            "required": true,
            "type": "enum",
            "enumRef": "enums.upgradeCategory"
          },
          { "name": "zoneId", "required": true, "type": "zoneId" },
          { "name": "cost_json", "required": true, "type": "json" },
          { "name": "effects_json", "required": true, "type": "json" },
          { "name": "requirements_json", "required": false, "type": "json" },
          { "name": "tags", "required": false, "type": "stringList" }
        ]
      },

      {
        "name": "Milestones",
        "required": true,
        "kind": "entity",
        "primaryKey": "id",
        "columns": [
          { "name": "id", "required": true, "type": "milestoneId" },
          { "name": "nodeId", "required": true, "type": "nodeTypeId" },
          { "name": "zoneId", "required": true, "type": "zoneId" },
          { "name": "atLevel", "required": true, "type": "int" },
          { "name": "grantEffects_json", "required": true, "type": "json" }
        ]
      },

      {
        "name": "Buffs",
        "required": true,
        "kind": "entity",
        "primaryKey": "id",
        "columns": [
          { "name": "id", "required": true, "type": "buffId" },
          { "name": "displayName", "required": true, "type": "string" },
          { "name": "zoneId", "required": true, "type": "zoneId" },
          {
            "name": "durationSeconds",
            "required": true,
            "type": "numberString"
          },
          {
            "name": "stacking",
            "required": false,
            "type": "enum",
            "enumRef": "enums.buffStacking"
          },
          { "name": "effects_json", "required": true, "type": "json" }
        ]
      },

      {
        "name": "UnlockGraph",
        "required": false,
        "kind": "entity",
        "primaryKey": "id",
        "columns": [
          { "name": "id", "required": true, "type": "unlockId" },
          { "name": "zoneId", "required": true, "type": "zoneId" },
          { "name": "unlocks_json", "required": true, "type": "json" },
          { "name": "requirements_json", "required": false, "type": "json" }
        ]
      },

      {
        "name": "Triggers",
        "required": false,
        "kind": "entity",
        "primaryKey": "id",
        "columns": [
          { "name": "id", "required": true, "type": "triggerId" },
          { "name": "zoneId", "required": true, "type": "zoneId" },
          {
            "name": "event",
            "required": true,
            "type": "enum",
            "enumRef": "enums.triggerEvent"
          },
          { "name": "scope_json", "required": true, "type": "json" },
          { "name": "conditions_json", "required": false, "type": "json" },
          { "name": "chance", "required": false, "type": "numberString" },
          {
            "name": "cooldownSeconds",
            "required": false,
            "type": "numberString"
          },
          {
            "name": "maxActivationsPerSession",
            "required": false,
            "type": "int"
          },
          { "name": "actions_json", "required": true, "type": "json" }
        ],
        "notes": [
          "Triggers can be normalized into subtables later (TriggerConditions/TriggerActions) if JSON-in-cells becomes too heavy."
        ]
      },

      {
        "name": "RewardPools",
        "required": false,
        "kind": "entity",
        "primaryKey": "id",
        "columns": [
          { "name": "id", "required": true, "type": "rewardPoolId" },
          { "name": "entries_json", "required": true, "type": "json" }
        ],
        "notes": [
          "A RewardPool is a weighted list of actions. The JSON shape is validated by GameDefinitionValidator."
        ]
      }
    ],

    "enums": {
      "resourceKind": [
        "softCurrency",
        "hardCurrency",
        "metaCurrency",
        "inventory"
      ],
      "resourceFormatStyle": ["currency", "suffix", "plain"],
      "nodeType": ["producer", "converter", "bottleneck", "sink"],
      "automationPolicy": [
        "alwaysOn",
        "manualCollect",
        "autoRepeat",
        "manualStart"
      ],
      "priceCurveType": ["exponential", "linear", "piecewise", "table"],
      "outputMode": ["rate", "cycle"],
      "capacityMode": ["capacity", "throughputPerSecond"],
      "scopeKind": ["global", "zone", "node", "nodeTag", "resource"],
      "modifierOperation": ["add", "multiply", "set", "clampMin", "clampMax"],
      "upgradeCategory": [
        "node",
        "global",
        "automation",
        "prestige",
        "progression"
      ],
      "buffStacking": ["none", "refresh", "extend", "ignore", "stack"],
      "triggerEvent": [
        "node.cycleComplete",
        "node.collect",
        "node.start",
        "node.levelPurchased",
        "resource.gained",
        "offline.claim",
        "ad.rewarded",
        "session.tick",
        "prestige.reset",
        "upgrade.purchased"
      ]
    }
  },

  "numberFormat": {
    "type": "mantissaExponent|decimalString",
    "precision": 16
  },

  "resources": [
    {
      "id": "string",
      "displayName": "string",
      "kind": "softCurrency|hardCurrency|metaCurrency|inventory",
      "format": { "style": "currency|suffix|plain", "symbol": "string?" },
      "stackLimit": null
    }
  ],

  "phases": [
    { "id": "phase.1", "displayName": "string", "description": "string?" }
  ],

  "zones": [
    {
      "id": "zone.main",
      "displayName": "string",
      "description": "string?",
      "startingPhaseId": "phase.1",
      "localResources": ["resourceId"],
      "tags": ["string"]
    }
  ],

  "computedVars": [
    {
      "id": "var.clipPrice",
      "displayName": "string?",
      "zoneId": "zone.main",
      "base": "numberString",
      "min": null,
      "max": null,
      "rounding": "none|floor|truncate|bankers",
      "expression": {
        "type": "constant|add|multiply|power|log10|min|max|clamp|if",
        "args": []
      },
      "dependsOn": ["resource[resourceId]", "state.run.someKey", "var.otherVar"]
    }
  ],

  "nodes": [
    {
      "id": "nodeTypeId",
      "type": "producer|converter|bottleneck|sink",
      "displayName": "string",
      "tags": ["string"],

      "zoneId": "zone.main",

      "inputs": [
        {
          "resource": "resourceId",
          "amountPerCycle": "bigNumberString?",
          "amountPerCycleFromVar": "varId?",
          "amountPerCycleFromState": "state.path?"
        }
      ],
      "outputs": [
        {
          "resource": "resourceId",
          "mode": "rate|cycle",
          "basePerSecond": "bigNumberString?",
          "basePayout": "bigNumberString?",
          "amountPerCycle": "bigNumberString?",
          "amountPerCycleFromVar": "varId?",
          "amountPerCycleFromState": "state.path?"
        }
      ],

      "cycle": { "baseDurationSeconds": "numberString" },

      "capacities": [
        {
          "resource": "resourceId",
          "capacityMode": "capacity|throughputPerSecond",
          "baseCapacity": "bigNumberString?",
          "baseCapacityPerSecond": "bigNumberString?"
        }
      ],

      "leveling": {
        "levelResource": "resourceId",
        "baseLevel": 0,
        "maxLevel": null,

        "priceCurve": {
          "type": "exponential|linear|piecewise|table",
          "basePrice": "bigNumberString",
          "growth": "numberString?",
          "increment": "bigNumberString?",
          "table": [{ "level": 1, "price": "bigNumberString" }],
          "segments": [
            {
              "fromLevel": 1,
              "toLevel": 50,
              "curve": {
                "type": "exponential",
                "basePrice": "bigNumberString",
                "growth": "numberString"
              }
            }
          ]
        },

        "outputScaling": [
          {
            "target": "outputs[resourceId].basePerSecond|outputs[resourceId].basePayout|outputs[resourceId].amountPerCycle",
            "perLevel": { "type": "add|multiply", "value": "numberString" }
          }
        ],

        "capacityScaling": [
          {
            "target": "capacities[resourceId].baseCapacity|capacities[resourceId].baseCapacityPerSecond",
            "perLevel": { "type": "add|multiply", "value": "numberString" }
          }
        ]
      },

      "automation": {
        "policy": "alwaysOn|manualCollect|autoRepeat|manualStart",
        "autoCollect": true,
        "autoRestart": true
      },

      "requirements": [
        {
          "type": "resourceAtLeast|unlock|nodeLevelAtLeast|phaseAtLeast|zoneUnlocked|upgradePurchased|buffActive",
          "args": {}
        }
      ]
    }
  ],

  "nodeInstances": [
    {
      "id": "instanceId",
      "nodeId": "nodeTypeId",
      "zoneId": "zone.main",
      "displayNameOverride": "string?",
      "tags": ["string"],
      "initialState": { "level": 0, "enabled": true }
    }
  ],

  "links": [
    {
      "id": "linkId",
      "zoneId": "zone.main",
      "from": "instanceId|nodeTypeId",
      "to": "instanceId|nodeTypeId",
      "resource": "resourceId",
      "mode": "push|pull",
      "priority": 0,
      "lossFactor": "1.0",
      "capacityPerSecondFrom": "state.path?|varId?",
      "enabledRequirements": []
    }
  ],

  "modifiers": [
    {
      "id": "modifierId",
      "source": "upgradeId|milestoneId|buffId|projectId|prestige|system",
      "zoneId": "zone.main",
      "scope": {
        "kind": "global|zone|node|nodeTag|resource",
        "zoneId": "zone.main?",
        "nodeId": "nodeTypeId?",
        "nodeTag": "string?",
        "resource": "resourceId?"
      },
      "operation": "add|multiply|set|clampMin|clampMax",
      "target": "nodeSpeedMultiplier|resourceGain[resourceId]|nodeOutput[resourceId]|nodeInput[resourceId]|nodeCapacity[resourceId].throughputPerSecond|state.run.key|var.varId|automation.policy",
      "value": "numberString?|bigNumberString?",
      "valueFromState": "state.path?",
      "valueFromVar": "varId?",
      "conditions": [
        {
          "type": "phaseAtLeast|zone|nodeEnabled|hasUpgrade|buffActive|randomChance",
          "args": {}
        }
      ]
    }
  ],

  "upgrades": [
    {
      "id": "upgradeId",
      "displayName": "string",
      "category": "node|global|automation|prestige|progression",
      "zoneId": "zone.main",

      "cost": [{ "resource": "resourceId", "amount": "bigNumberString" }],

      "repeatable": false,
      "maxRank": 1,
      "rankCostScaling": {
        "type": "exponential|linear|table",
        "basePriceMultiplier": "numberString",
        "growth": "numberString"
      },

      "effects": [{ "modifierId": "modifierId" }],

      "requirements": [],
      "tags": ["string"]
    }
  ],

  "milestones": [
    {
      "id": "milestoneId",
      "nodeId": "nodeTypeId",
      "zoneId": "zone.main",
      "atLevel": 25,
      "grantEffects": [{ "modifierId": "modifierId" }]
    }
  ],

  "projects": [
    {
      "id": "projectId",
      "displayName": "string",
      "zoneId": "zone.main",
      "timeSeconds": 0,
      "cost": [{ "resource": "resourceId", "amount": "bigNumberString" }],
      "effects": [{ "modifierId": "modifierId" }],
      "requirements": [],
      "exclusiveGroup": "string?",
      "tags": ["string"]
    }
  ],

  "unlockGraph": [
    {
      "id": "unlockId",
      "zoneId": "zone.main",
      "unlocks": [
        {
          "kind": "node|nodeInstance|upgrade|project|zone|phase|modifier",
          "id": "string"
        }
      ],
      "requirements": [
        {
          "type": "resourceAtLeast|unlock|nodeLevelAtLeast|phaseAtLeast|zoneUnlocked|upgradePurchased|buffActive",
          "args": {}
        }
      ]
    }
  ],

  "triggers": [
    {
      "id": "triggerId",
      "zoneId": "zone.main",
      "event": "node.cycleComplete|node.collect|node.start|node.levelPurchased|resource.gained|offline.claim|ad.rewarded|session.tick|prestige.reset|upgrade.purchased",
      "scope": {
        "kind": "global|zone|node|nodeTag|resource",
        "zoneId": "zone.main?",
        "nodeId": "nodeTypeId?",
        "nodeTag": "string?",
        "resource": "resourceId?"
      },

      "conditions": [
        {
          "type": "resourceAtLeast|unlock|nodeLevelAtLeast|phaseAtLeast|zoneUnlocked|upgradePurchased|buffActive",
          "args": {}
        }
      ],

      "chance": "numberString?",
      "cooldownSeconds": "numberString?",
      "maxActivationsPerSession": 0,

      "actions": [
        {
          "type": "grantResource|applyBuff|removeBuff|timeWarp|completeCycle|startNode|rollRewardPool|incrementCounter",

          "resourceId": "resourceId?",
          "amount": "bigNumberString?",
          "buffId": "buffId?",
          "durationSeconds": "numberString?",

          "seconds": "numberString?",
          "mode": "simulate|creditOffline?",

          "nodeInstanceId": "instanceId?",
          "rewardPoolId": "rewardPoolId?",
          "counterId": "string?"
        }
      ]
    }
  ],

  "buffs": [
    {
      "id": "buffId",
      "displayName": "string",
      "zoneId": "zone.main",
      "durationSeconds": 600,
      "stacking": "refresh|extend|ignore|stack",
      "effects": [{ "modifierId": "modifierId" }]
    }
  ],

  "rewardPools": [
    {
      "id": "rewardPoolId",
      "entries": [
        {
          "weight": 1,
          "action": {
            "type": "grantResource|applyBuff|removeBuff|timeWarp|completeCycle|startNode|rollRewardPool|incrementCounter",
            "resourceId": "resourceId?",
            "amount": "bigNumberString?",
            "buffId": "buffId?",
            "durationSeconds": "numberString?",
            "seconds": "numberString?",
            "mode": "simulate|creditOffline?",
            "nodeInstanceId": "instanceId?",
            "rewardPoolId": "rewardPoolId?",
            "counterId": "string?"
          }
        }
      ]
    }
  ],

  "prestige": {
    "enabled": false,
    "zoneId": "zone.main",
    "prestigeResource": "resourceId",
    "formula": {
      "type": "sqrt|log10|linear|customExpression",
      "basedOn": "lifetimeEarnings[resourceId]|state.path|resource[resourceId]",
      "multiplier": "numberString",
      "offset": "bigNumberString",
      "expressionVarId": "varId?"
    },
    "resetScopes": {
      "resetNodes": true,
      "resetSoftCurrencies": true,
      "keepHardCurrencies": true,
      "keepUnlocks": [],
      "keepUpgrades": [],
      "keepProjects": []
    },
    "metaUpgrades": [
      {
        "id": "metaUpgradeId",
        "displayName": "string",
        "computed": {
          "type": "linear",
          "basedOn": "resource[resourceId]",
          "multiplier": "numberString",
          "offset": "bigNumberString"
        },
        "writesToState": "state.path"
      }
    ]
  }
}
